<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="./CSS/headers.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <title>ZeroPads - MLS Page</title>
</head>
<style>
  /* Navigation Formatting not active */
.nav-pills .pill-1 .nav-link:not(.active) {
  background-color: white;
  color: black;
}

/* Navigation Formatting active */
.nav-pills .pill-1 .nav-link {
  background-color: rgba(57, 181, 74, 1);
  color: white;
}

</style>
<body>
  <!-- Navigation Bar-->
  <div class="container">
    <!-- Header Section-->
    <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
      <a href="index.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
        <img id="logo" src="./images/header_logo.png" width="63" height="32">
        <span class="fs-4">Team ZeroPads Group Assignment</span>
      </a>
      <nav class="navbar nav-expand-lg navbar-light">
        <ul class="nav nav-pills">
          <li class="nav-item pill-1"><a href="./index.html" class="nav-link">Home</a></li>
          <li class="nav-item pill-1"><a href="./mls.html" class="nav-link active" aria-current="page">Find Housing</a></li>
        </ul>
      </nav>

    </header>
    <!-- End Header -->
  </div>

  <!-- Body Section-->
  <center>
  <div class="body">  
      <br>
    <h4>Ready to search for listings?</h4>
    <p>Enter your city and state abreviation below to search</p><br>
    <form class="form-inline my-2 my-lg-0 justify-content-center">
        <label>City: </label>
        <input class="form-control mr-sm-2" type="search" placeholder="Ex: Canton" aria-label="Search" id="city">
        <label>State (Abreviated): </label>
        <input class="form-control mr-sm-2" type="search" placeholder="Ex: GA" aria-label="Search" id="state">
        <button class="btn btn-outline-success my-2 my-sm-0" id="search" value="search" type="button" onclick="findHome">Search</button>
      </form>
</div>
</center>

  <!-- End Body -->
    <footer>
    <!-- Copyright -->
    <div class="text-center text-dark p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      Â© 2021 Copyright:
      <a class="text-dark" href="https://www.zeropads.org/">ZEROPADS DEVELOPMENT GROUP INC.</a>
    </div>
    <!-- Copyright -->
  </footer>


</body>

<script type="text/javascript">

    document.getElementById("search").addEventListener("click", findHome);

    function findHome(e){
      var city = document.getElementById("city").value;
      var state = document.getElementById("state").value;  

      if(state.length !== 2){
        errorHandle(2);
        return;
      }
        
      const url = 'https://us-real-estate.p.rapidapi.com/for-sale?offset=0&limit=10&state_code='+state+'&city='+city+'&sort=newest';
      console.log(url);
      fetch(url, {
            "method": "GET",
            "headers": {
          "x-rapidapi-host": "us-real-estate.p.rapidapi.com",
          "x-rapidapi-key": "218ebec704mshd75e7df5031dbe6p133a54jsn81b575145120"
            }
          })
      .then(function(response) {
        if(response.status !== 200){
          errorHandle(1);
          return;
        }
        return response.json();
      }).then(function(data) {
        parseData(data);
      })
      .catch(err => {
          console.log(err);
      });
    }

function parseData(data){
  var searchResultStats = [];
  var length = data.data.count;
  if(data.data.results === null ){
    errorHandle(2);
    return;
  }else{
    for(i=0; i<length; i++){
      var address = data.data.results[i].location.address;
      var photos = data.data.results[i].primary_photo.href;
      var listingPrice = data.data.results[i].list_price;
      var listingDate = data.data.results[i].list_date;
      var numBed =  data.data.results[i].description.beds;
      var numBath = data.data.results[i].description.baths;
      var sqFoot = data.data.results[i].description.sqft;
      var type = data.data.results[i].description.type;
      var yearBuilt = data.data.results[i].description.year_built;
      var listingAgent = data.data.results[i].branding[0].name;

      var singleStats = {
        address: address,
        photos: photos, 
        listingPrice: listingPrice,
        numBed: numBed,
        numBath: numBath, 
        sqFoot: sqFoot,
        type: type,
        yearBuilt: yearBuilt,
        listingAgent: listingAgent
      };
      // gathering 10 of the results and putting them all into an array
      searchResultStats.push(JSON.stringify(singleStats));
    }

    // printing out array to the console
    for(i=0; i<length; i++){
      console.log(searchResultStats[i]);
    }
    console.log(data.data.results[0]);
  }// for
}

function errorHandle(err){
  if(err == 1){
    alert("We're sorry, your results could not be calculated. Please make sure you enter a valid city/state combination.")
  }if (err == 2){
    alert("We're sorry, your results could not be calculated. Please make sure you enter a valid city/state combination. In some cases, we may not have any homes available in the city/state you provided")
  }
}
</script>
</html>
